<script>
  const params = new URLSearchParams(location.search);
  const code = params.get("code");

  if (code) {
    fetch("http://localhost:4000/exchange-code", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code }),
    })
    .then(res => res.json())
    .then(data => {
      const token = data.access_token;

      if (token) {
        // Replace <YOUR_UUID> with your actual extension UUID
        const extensionURL = "moz-extension://6d63a163-e96f-461a-ad9a-b3acb033ccd0/popup/popup.html?token=" + token;
        window.location.href = extensionURL;
      } else {
        document.body.innerHTML = "<h2>❌ Token Exchange Failed (No token)</h2>";
      }
    })
    .catch(err => {
      document.body.innerHTML = "<h2>❌ Token Exchange Failed</h2>";
      console.error(err);
    });
  } else {
    document.body.innerHTML = "<h2>❌ No code in URL</h2>";
  }
</script>
